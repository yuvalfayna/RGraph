{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nconst utils_1 = require(\"../utils\");\nconst Deque = require(\"denque\");\nconst debug = (0, utils_1.Debug)(\"delayqueue\");\n/**\n * Queue that runs items after specified duration\n */\nclass DelayQueue {\n  constructor() {\n    this.queues = {};\n    this.timeouts = {};\n  }\n  /**\n   * Add a new item to the queue\n   *\n   * @param bucket bucket name\n   * @param item function that will run later\n   * @param options\n   */\n  push(bucket, item, options) {\n    const callback = options.callback || process.nextTick;\n    if (!this.queues[bucket]) {\n      this.queues[bucket] = new Deque();\n    }\n    const queue = this.queues[bucket];\n    queue.push(item);\n    if (!this.timeouts[bucket]) {\n      this.timeouts[bucket] = setTimeout(() => {\n        callback(() => {\n          this.timeouts[bucket] = null;\n          this.execute(bucket);\n        });\n      }, options.timeout);\n    }\n  }\n  execute(bucket) {\n    const queue = this.queues[bucket];\n    if (!queue) {\n      return;\n    }\n    const {\n      length\n    } = queue;\n    if (!length) {\n      return;\n    }\n    debug(\"send %d commands in %s queue\", length, bucket);\n    this.queues[bucket] = null;\n    while (queue.length > 0) {\n      queue.shift()();\n    }\n  }\n}\nexports.default = DelayQueue;","map":{"version":3,"names":["Object","defineProperty","exports","value","utils_1","require","Deque","debug","Debug","DelayQueue","constructor","queues","timeouts","push","bucket","item","options","callback","process","nextTick","queue","setTimeout","execute","timeout","length","shift","default"],"sources":["C:/rgraph/node_modules/ioredis/built/cluster/DelayQueue.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst utils_1 = require(\"../utils\");\nconst Deque = require(\"denque\");\nconst debug = (0, utils_1.Debug)(\"delayqueue\");\n/**\n * Queue that runs items after specified duration\n */\nclass DelayQueue {\n    constructor() {\n        this.queues = {};\n        this.timeouts = {};\n    }\n    /**\n     * Add a new item to the queue\n     *\n     * @param bucket bucket name\n     * @param item function that will run later\n     * @param options\n     */\n    push(bucket, item, options) {\n        const callback = options.callback || process.nextTick;\n        if (!this.queues[bucket]) {\n            this.queues[bucket] = new Deque();\n        }\n        const queue = this.queues[bucket];\n        queue.push(item);\n        if (!this.timeouts[bucket]) {\n            this.timeouts[bucket] = setTimeout(() => {\n                callback(() => {\n                    this.timeouts[bucket] = null;\n                    this.execute(bucket);\n                });\n            }, options.timeout);\n        }\n    }\n    execute(bucket) {\n        const queue = this.queues[bucket];\n        if (!queue) {\n            return;\n        }\n        const { length } = queue;\n        if (!length) {\n            return;\n        }\n        debug(\"send %d commands in %s queue\", length, bucket);\n        this.queues[bucket] = null;\n        while (queue.length > 0) {\n            queue.shift()();\n        }\n    }\n}\nexports.default = DelayQueue;\n"],"mappings":"AAAA,YAAY;;AACZA,MAAM,CAACC,cAAc,CAACC,OAAO,EAAE,YAAY,EAAE;EAAEC,KAAK,EAAE;AAAK,CAAC,CAAC;AAC7D,MAAMC,OAAO,GAAGC,OAAO,CAAC,UAAU,CAAC;AACnC,MAAMC,KAAK,GAAGD,OAAO,CAAC,QAAQ,CAAC;AAC/B,MAAME,KAAK,GAAG,CAAC,CAAC,EAAEH,OAAO,CAACI,KAAK,EAAE,YAAY,CAAC;AAC9C;AACA;AACA;AACA,MAAMC,UAAU,CAAC;EACbC,WAAWA,CAAA,EAAG;IACV,IAAI,CAACC,MAAM,GAAG,CAAC,CAAC;IAChB,IAAI,CAACC,QAAQ,GAAG,CAAC,CAAC;EACtB;EACA;AACJ;AACA;AACA;AACA;AACA;AACA;EACIC,IAAIA,CAACC,MAAM,EAAEC,IAAI,EAAEC,OAAO,EAAE;IACxB,MAAMC,QAAQ,GAAGD,OAAO,CAACC,QAAQ,IAAIC,OAAO,CAACC,QAAQ;IACrD,IAAI,CAAC,IAAI,CAACR,MAAM,CAACG,MAAM,CAAC,EAAE;MACtB,IAAI,CAACH,MAAM,CAACG,MAAM,CAAC,GAAG,IAAIR,KAAK,CAAC,CAAC;IACrC;IACA,MAAMc,KAAK,GAAG,IAAI,CAACT,MAAM,CAACG,MAAM,CAAC;IACjCM,KAAK,CAACP,IAAI,CAACE,IAAI,CAAC;IAChB,IAAI,CAAC,IAAI,CAACH,QAAQ,CAACE,MAAM,CAAC,EAAE;MACxB,IAAI,CAACF,QAAQ,CAACE,MAAM,CAAC,GAAGO,UAAU,CAAC,MAAM;QACrCJ,QAAQ,CAAC,MAAM;UACX,IAAI,CAACL,QAAQ,CAACE,MAAM,CAAC,GAAG,IAAI;UAC5B,IAAI,CAACQ,OAAO,CAACR,MAAM,CAAC;QACxB,CAAC,CAAC;MACN,CAAC,EAAEE,OAAO,CAACO,OAAO,CAAC;IACvB;EACJ;EACAD,OAAOA,CAACR,MAAM,EAAE;IACZ,MAAMM,KAAK,GAAG,IAAI,CAACT,MAAM,CAACG,MAAM,CAAC;IACjC,IAAI,CAACM,KAAK,EAAE;MACR;IACJ;IACA,MAAM;MAAEI;IAAO,CAAC,GAAGJ,KAAK;IACxB,IAAI,CAACI,MAAM,EAAE;MACT;IACJ;IACAjB,KAAK,CAAC,8BAA8B,EAAEiB,MAAM,EAAEV,MAAM,CAAC;IACrD,IAAI,CAACH,MAAM,CAACG,MAAM,CAAC,GAAG,IAAI;IAC1B,OAAOM,KAAK,CAACI,MAAM,GAAG,CAAC,EAAE;MACrBJ,KAAK,CAACK,KAAK,CAAC,CAAC,CAAC,CAAC;IACnB;EACJ;AACJ;AACAvB,OAAO,CAACwB,OAAO,GAAGjB,UAAU","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}