{"ast":null,"code":"\"use strict\";\n\nconst Deferred = require(\"./Deferred\");\nconst errors = require(\"./errors\");\nfunction fbind(fn, ctx) {\n  return function bound() {\n    return fn.apply(ctx, arguments);\n  };\n}\n\n/**\n * Wraps a users request for a resource\n * Basically a promise mashed in with a timeout\n * @private\n */\nclass ResourceRequest extends Deferred {\n  /**\n   * [constructor description]\n   * @param  {Number} ttl     timeout\n   */\n  constructor(ttl, Promise) {\n    super(Promise);\n    this._creationTimestamp = Date.now();\n    this._timeout = null;\n    if (ttl !== undefined) {\n      this.setTimeout(ttl);\n    }\n  }\n  setTimeout(delay) {\n    if (this._state !== ResourceRequest.PENDING) {\n      return;\n    }\n    const ttl = parseInt(delay, 10);\n    if (isNaN(ttl) || ttl <= 0) {\n      throw new Error(\"delay must be a positive int\");\n    }\n    const age = Date.now() - this._creationTimestamp;\n    if (this._timeout) {\n      this.removeTimeout();\n    }\n    this._timeout = setTimeout(fbind(this._fireTimeout, this), Math.max(ttl - age, 0));\n  }\n  removeTimeout() {\n    if (this._timeout) {\n      clearTimeout(this._timeout);\n    }\n    this._timeout = null;\n  }\n  _fireTimeout() {\n    this.reject(new errors.TimeoutError(\"ResourceRequest timed out\"));\n  }\n  reject(reason) {\n    this.removeTimeout();\n    super.reject(reason);\n  }\n  resolve(value) {\n    this.removeTimeout();\n    super.resolve(value);\n  }\n}\nmodule.exports = ResourceRequest;","map":{"version":3,"names":["Deferred","require","errors","fbind","fn","ctx","bound","apply","arguments","ResourceRequest","constructor","ttl","Promise","_creationTimestamp","Date","now","_timeout","undefined","setTimeout","delay","_state","PENDING","parseInt","isNaN","Error","age","removeTimeout","_fireTimeout","Math","max","clearTimeout","reject","TimeoutError","reason","resolve","value","module","exports"],"sources":["C:/rgraph/node_modules/generic-pool/lib/ResourceRequest.js"],"sourcesContent":["\"use strict\";\n\nconst Deferred = require(\"./Deferred\");\nconst errors = require(\"./errors\");\n\nfunction fbind(fn, ctx) {\n  return function bound() {\n    return fn.apply(ctx, arguments);\n  };\n}\n\n/**\n * Wraps a users request for a resource\n * Basically a promise mashed in with a timeout\n * @private\n */\nclass ResourceRequest extends Deferred {\n  /**\n   * [constructor description]\n   * @param  {Number} ttl     timeout\n   */\n  constructor(ttl, Promise) {\n    super(Promise);\n    this._creationTimestamp = Date.now();\n    this._timeout = null;\n\n    if (ttl !== undefined) {\n      this.setTimeout(ttl);\n    }\n  }\n\n  setTimeout(delay) {\n    if (this._state !== ResourceRequest.PENDING) {\n      return;\n    }\n    const ttl = parseInt(delay, 10);\n\n    if (isNaN(ttl) || ttl <= 0) {\n      throw new Error(\"delay must be a positive int\");\n    }\n\n    const age = Date.now() - this._creationTimestamp;\n\n    if (this._timeout) {\n      this.removeTimeout();\n    }\n\n    this._timeout = setTimeout(\n      fbind(this._fireTimeout, this),\n      Math.max(ttl - age, 0)\n    );\n  }\n\n  removeTimeout() {\n    if (this._timeout) {\n      clearTimeout(this._timeout);\n    }\n    this._timeout = null;\n  }\n\n  _fireTimeout() {\n    this.reject(new errors.TimeoutError(\"ResourceRequest timed out\"));\n  }\n\n  reject(reason) {\n    this.removeTimeout();\n    super.reject(reason);\n  }\n\n  resolve(value) {\n    this.removeTimeout();\n    super.resolve(value);\n  }\n}\n\nmodule.exports = ResourceRequest;\n"],"mappings":"AAAA,YAAY;;AAEZ,MAAMA,QAAQ,GAAGC,OAAO,CAAC,YAAY,CAAC;AACtC,MAAMC,MAAM,GAAGD,OAAO,CAAC,UAAU,CAAC;AAElC,SAASE,KAAKA,CAACC,EAAE,EAAEC,GAAG,EAAE;EACtB,OAAO,SAASC,KAAKA,CAAA,EAAG;IACtB,OAAOF,EAAE,CAACG,KAAK,CAACF,GAAG,EAAEG,SAAS,CAAC;EACjC,CAAC;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA,MAAMC,eAAe,SAAST,QAAQ,CAAC;EACrC;AACF;AACA;AACA;EACEU,WAAWA,CAACC,GAAG,EAAEC,OAAO,EAAE;IACxB,KAAK,CAACA,OAAO,CAAC;IACd,IAAI,CAACC,kBAAkB,GAAGC,IAAI,CAACC,GAAG,CAAC,CAAC;IACpC,IAAI,CAACC,QAAQ,GAAG,IAAI;IAEpB,IAAIL,GAAG,KAAKM,SAAS,EAAE;MACrB,IAAI,CAACC,UAAU,CAACP,GAAG,CAAC;IACtB;EACF;EAEAO,UAAUA,CAACC,KAAK,EAAE;IAChB,IAAI,IAAI,CAACC,MAAM,KAAKX,eAAe,CAACY,OAAO,EAAE;MAC3C;IACF;IACA,MAAMV,GAAG,GAAGW,QAAQ,CAACH,KAAK,EAAE,EAAE,CAAC;IAE/B,IAAII,KAAK,CAACZ,GAAG,CAAC,IAAIA,GAAG,IAAI,CAAC,EAAE;MAC1B,MAAM,IAAIa,KAAK,CAAC,8BAA8B,CAAC;IACjD;IAEA,MAAMC,GAAG,GAAGX,IAAI,CAACC,GAAG,CAAC,CAAC,GAAG,IAAI,CAACF,kBAAkB;IAEhD,IAAI,IAAI,CAACG,QAAQ,EAAE;MACjB,IAAI,CAACU,aAAa,CAAC,CAAC;IACtB;IAEA,IAAI,CAACV,QAAQ,GAAGE,UAAU,CACxBf,KAAK,CAAC,IAAI,CAACwB,YAAY,EAAE,IAAI,CAAC,EAC9BC,IAAI,CAACC,GAAG,CAAClB,GAAG,GAAGc,GAAG,EAAE,CAAC,CACvB,CAAC;EACH;EAEAC,aAAaA,CAAA,EAAG;IACd,IAAI,IAAI,CAACV,QAAQ,EAAE;MACjBc,YAAY,CAAC,IAAI,CAACd,QAAQ,CAAC;IAC7B;IACA,IAAI,CAACA,QAAQ,GAAG,IAAI;EACtB;EAEAW,YAAYA,CAAA,EAAG;IACb,IAAI,CAACI,MAAM,CAAC,IAAI7B,MAAM,CAAC8B,YAAY,CAAC,2BAA2B,CAAC,CAAC;EACnE;EAEAD,MAAMA,CAACE,MAAM,EAAE;IACb,IAAI,CAACP,aAAa,CAAC,CAAC;IACpB,KAAK,CAACK,MAAM,CAACE,MAAM,CAAC;EACtB;EAEAC,OAAOA,CAACC,KAAK,EAAE;IACb,IAAI,CAACT,aAAa,CAAC,CAAC;IACpB,KAAK,CAACQ,OAAO,CAACC,KAAK,CAAC;EACtB;AACF;AAEAC,MAAM,CAACC,OAAO,GAAG5B,eAAe","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}